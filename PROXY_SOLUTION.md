# Решение проблемы блокировок в РФ/Беларуси

## Проблема

GoogleGenAI SDK использует WebSocket соединения напрямую к Google API (`generativelanguage.googleapis.com`). Трафик идет от клиента напрямую к Google, что не работает в РФ/Беларуси без VPN.

## Решение

Нужно проксировать все запросы через сервер на Netlify/Render, чтобы трафик шел:
```
Клиент → Netlify/Render → Google API
```
вместо:
```
Клиент → Google API (заблокировано)
```

## Реализованные изменения

### 1. Создан WebSocket прокси на Python (`gemini_ws_proxy.py`)
- Проксирует WebSocket соединения от клиента к Google API
- Запускается на отдельном порту (8765 по умолчанию)

### 2. Добавлен endpoint на сервере (`bot.py`)
- `/api/gemini/ws-proxy-info` - возвращает информацию о WebSocket прокси

### 3. Обновлен клиент (`App.tsx`)
- Добавлены комментарии о проблеме
- Подготовлена структура для использования прокси

### 4. Обновлен `netlify.toml`
- Добавлены WebSocket подключения в CSP заголовки

## Текущее состояние

**⚠️ ВАЖНО:** Полное решение требует модификации GoogleGenAI SDK или создания кастомной реализации, так как SDK использует внутренний WebSocket URL, который нельзя легко изменить.

## Варианты решения

### Вариант 1: Прокси на уровне сети (рекомендуется)
Использовать прокси-сервер на уровне браузера или операционной системы:
- SOCKS/HTTP прокси
- VPN
- Proxy расширения для браузера

### Вариант 2: Серверный WebSocket прокси (частично реализовано)
1. Запустить `gemini_ws_proxy.py` на Render сервере
2. Изменить клиент для использования этого прокси
3. Настроить Netlify для проксирования через Render

### Вариант 3: Кастомная реализация (сложно)
Создать собственную реализацию без использования SDK:
- Прямая работа с Google Gemini API через WebSocket
- Полный контроль над URL и проксированием

## Следующие шаги

1. ✅ Создан WebSocket прокси (`gemini_ws_proxy.py`)
2. ⏳ Интегрировать прокси в `bot.py` (запуск в отдельном потоке)
3. ⏳ Изменить клиент для использования прокси URL
4. ⏳ Настроить Netlify для проксирования WebSocket
5. ⏳ Протестировать решение

## Временное решение

Пока полное решение не реализовано, пользователи в РФ/Беларуси могут:
- Использовать VPN
- Использовать прокси на уровне браузера/ОС
- Использовать браузеры с поддержкой обхода блокировок (Chrome/Firefox с DoH)

