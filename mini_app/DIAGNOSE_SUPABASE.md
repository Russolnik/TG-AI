# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Mini App –∫ Supabase

## –ü—Ä–æ–±–ª–µ–º–∞
Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Supabase, –Ω–æ Mini App –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API –∫–ª—é—á–∞

**Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã**, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5cmtudHdlcnZicnVyc25leW5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MzI1NDksImV4cCI6MjA3NzUwODU0OX0.D1pSh-60JmROW6zh7g_kjnH1tDuYxWOC0DiSfo3oR4o
```

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–∏ –≤–∏–¥–∞:**
- `sb_publishable_...` ‚ùå
- `sb_secret_...` ‚ùå

–≠—Ç–∏ –∫–ª—é—á–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, Stripe) –∏ –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è Supabase.

## –ö–∞–∫ –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [app.supabase.com](https://app.supabase.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **API**

### –®–∞–≥ 2: –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏

–í —Ä–∞–∑–¥–µ–ª–µ **API Settings** –≤—ã —É–≤–∏–¥–∏—Ç–µ:

1. **Project URL** - —ç—Ç–æ –≤–∞—à `SUPABASE_URL`
   ```
   https://pyrkntwervbrursneynd.supabase.co
   ```

2. **anon public** –∫–ª—é—á - —ç—Ç–æ –≤–∞—à `SUPABASE_KEY` –¥–ª—è Mini App
   ```
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```
   –≠—Ç–æ –¥–ª–∏–Ω–Ω—ã–π JWT —Ç–æ–∫–µ–Ω, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å `eyJ...`

3. **service_role** –∫–ª—é—á (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π) - —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
   ‚ö†Ô∏è **–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ!**

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã

#### 1. –û–±–Ω–æ–≤–∏—Ç–µ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```env
SUPABASE_URL=https://pyrkntwervbrursneynd.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (anon public –∫–ª—é—á)
```

#### 2. –û–±–Ω–æ–≤–∏—Ç–µ `mini_app/app.js`:
–ó–∞–º–µ–Ω–∏—Ç–µ `DEFAULT_SUPABASE_KEY` –Ω–∞ –≤–∞—à `anon public` –∫–ª—é—á –∏–∑ Supabase Dashboard.

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Row Level Security (RLS)

–ï—Å–ª–∏ Mini App –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é `supabase/migrations/004_enable_anon_access.sql`:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí **SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `supabase/migrations/004_enable_anon_access.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ (Run)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ RLS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑—Ä–µ—à–∞—é—Ç –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø:

```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE POLICY "Allow users to read own chats"
ON chats FOR SELECT
USING (true);

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–æ–≤
CREATE POLICY "Allow users to create chats"
ON chats FOR INSERT
WITH CHECK (true);

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–∞—Ç–æ–≤
CREATE POLICY "Allow users to update own chats"
ON chats FOR UPDATE
USING (true);

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–æ–≤
CREATE POLICY "Allow users to delete own chats"
ON chats FOR DELETE
USING (true);
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü `messages` –∏ `users`.

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS

1. –í Supabase Dashboard ‚Üí **Settings** ‚Üí **API**
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **CORS** –∏–ª–∏ **Allowed Origins**
3. –î–æ–±–∞–≤—å—Ç–µ:
   - `https://*.netlify.app` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Netlify)
   - `https://*.telegram.org`
   - –í–∞—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–º–µ–Ω Mini App

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Mini App –≤ Telegram**
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Console**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - ‚úÖ `Supabase –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω` - —Ö–æ—Ä–æ—à–æ
   - ‚úÖ `–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω!` - –æ—Ç–ª–∏—á–Ω–æ, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚ùå `Failed to fetch` - –ø—Ä–æ–±–ª–µ–º–∞ —Å CORS –∏–ª–∏ —Å–µ—Ç—å—é
   - ‚ùå `401 Unauthorized` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á
   - ‚ùå `404 not found` - —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞:**
   ```
   Key —Ñ–æ—Ä–º–∞—Ç: eyJhbGciOiJIUzI1NiIsInR...
   Key –¥–ª–∏–Ω–∞: ~200+ —Å–∏–º–≤–æ–ª–æ–≤
   ```
   –ï—Å–ª–∏ –∫–ª—é—á –∫–æ—Ä–æ—Ç–∫–∏–π (–º–µ–Ω–µ–µ 100 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sb_`, –æ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.

2. **–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
   ```
   ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω! –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: X
   ```
   –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

3. **–û—à–∏–±–∫–∏:**
   - –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `401`, –∫–ª—é—á –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `Failed to fetch`, –ø—Ä–æ–±–ª–µ–º–∞ —Å CORS
   - –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `404` –∏–ª–∏ –æ—à–∏–±–∫–∏ RLS, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –†–µ–∑—é–º–µ

1. ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **anon public** JWT —Ç–æ–∫–µ–Ω (–Ω–µ `sb_publishable_...`)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –æ–±–Ω–æ–≤–ª–µ–Ω –≤ `.env` –∏ –≤ `mini_app/app.js`
3. ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RLS
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –≤ Supabase Dashboard
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `.env`
6. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ Mini App –≤ Telegram (–∑–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞)

